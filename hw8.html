<!doctype html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>CD Collection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
  </head>

  <body class="container m-3 p-3">
    <header class="bg-primary text-white text-center">
      <h1>Homework 8 - AJAX Application</h1>
      <p>A simple CD collection application using AJAX</p>
    </header>
    <nav class="navbar navbar-expand-md navbar-light bg-light">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarNav" aria-controls="navbarNav"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="index.html"> Home </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="hw2.html"> HW 2 </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="hw3.html"> HW 3 </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="hw4.html"> HW 4 </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="hw5.html"> HW 5 </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="hw6.html"> HW 6 </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="hw7.html"> HW 7 </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="hw8.html"> HW 8 </a>
          </li>
        </ul>
      </div>
    </nav>
    <main class="p-3 mb-3 m-2">
      <h2>Part 1: AJAX Application - CD Catalog</h2>
      <p>
        AJAX (Asynchronous JavaScript and XML) is a technique for creating
        dynamic web pages. It allows web applications to send and receive data
        asynchronously,
        without interfering with the display and behavior of the existing page.
        AJAX applications are
        built using JavaScript, HTML, and XML.
      </p>
      <p>
        The AJAX code in the application fetches the CD catalog XML file from
        the server using an XMLHttpRequest. The XMLHttpRequest object sends an
        HTTP GET request to the API
        endpoint and handles the response by updating the table with the
        user data. The response is in XML format, which is parsed and processed
        by the myFunction function. The myFunction function extracts the CD data
        from the XML response and dynamically generates an HTML table row for
        each CD.
      </p>
      <p>
        The application also includes a clearTable function that clears the
        table before adding new data. This ensures that the table is updated
        with the latest CD catalog data each time the Load CD Catalog button is
        clicked.
      </p>
      <p>
        The myFunction processes the XML response and extracts the
        CD data, formats it, and dynamically generates an HTML table row for
        each CD. The clearTable function is used to clear the table before
        adding new data.
      </p>
      <p>
        Note: This example uses a simple XML file for the CD catalog. In a real
        application, you would replace the file URL with the actual API endpoint
        for fetching the CD catalog data.
      </p>
      <div class="text-center">
        <button type="button" class="btn btn-primary"
          onclick="loadCDCatalog()">Load
          CD Catalog</button>
        <button type="button" class="btn btn-secondary"
          onclick="clearCDCatalogTable()">Clear</button>

      </div>
      <p id="status"></p>
      <div class="progress">
        <divdiv id="progressBar" class="progress-bar" role="progressbar"
          style="width: 0%;" aria-valuenow="0" aria-valuemin="0"
          aria-valuemax="100" aria-label="Loading progress">
      </div>
      </div>
      <div id="cdCatalogContainer">
        <h2>CD Catalog</h2>
        <p>
          The table below displays the CD catalog fetched from the remote server
        </p>
        <div class="row">
          <div class="col-sm-12">
            <table id="cdCatalogTable"
              class="table table-responsive table-bordered visually-hidden">
              <thead>
                <tr>
                  <th scope="col">Artist</th>
                  <th scope="col">Title</th>
                  <th scope="col">Year</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <hr>

      <h2> Part 2: API Proposal - Randomuser.me</h2>
      <p>
        One of the most tedius tasks when developing a web application is
        creating user data for testing purposes. This is because the user data
        needs to be realistic and unique, which can be difficult to create
        manually. For our app, AddressBook, in an effort to save time and money,
        I propose using the Randomuser.me API to generate random user data. This
        API provides a simple and easy way to generate random user data in JSON
        format, which can be used to populate the AddressBook application with
        realistic user data.
        The <a href="https://randomuser.me"> Randomuser.me</a>API allows you to
        generate a specified number of random user objects. Each user object
        contains a set of properties, such as first name, last name, email,
        phone number, address, city, state, country, postcode, coordinates,
        timezone, gender, age, and date of birth. The API also provides a
        profile picture for each user, which can be displayed in the web
        application. The user data generated by the Randomuser.me API is
        realistic and diverse, making it ideal for testing and development
        purposes.
      </p>
      <p>
        To use the Randomuser.me API in your web application, you need to make
        an HTTP get request or fetch call to the API endpoint with the desired
        parameters. The
        API endpoint is <a
          href="https://randomuser.me/api/">https://randomuser.me/api</a>.
      </p>
      <p>
        The API endpoint accepts the following parameters:
      <ul>
        <li>format (optional): The desired response format (default: JSON)</li>
        <li>results (optional): The number of random user objects to return
          (default: 1)</li>
        <li>page (optional): The page number of results to return (default: 1)
        </li>
        <li>seed (optional): A random seed to ensure reproducibility of results
          (default: a random UUID)</li>
        <li>nat (optional): The country code of the users' addresses (default:
          all)</li>
        <li>inc (optional): A comma-separated list of properties to include
          in the response (default: "name,gender,location")</li>
        <li>exc (optional): A comma-separated list of properties to exclude
          from the response (default: none)</li>
        <li>fields (optional): A comma-separated list of fields to
          include in the response (default: all)</li>
        <li>noinfo (optional): A flag to exclude additional user
          information (default: false)</li>
        <li>nocache (optional): A flag to prevent the use of cached
          results (default: false)</li>
      </ul>


      <p>
        The Randomuser.me API provides detailed documentation on its endpoints,
        parameters, and response formats. You can find the documentation at the
        following link:
        <a href="https://randomuser.me/documentation">Randomuser.me
          Documentation</a>.
      </p>
      <h2>Charges and Pricing</h2>
      <p>
        The Randomuser.me API does not require an API key to access and use the
        API. The API is free to use for both personal and commercial projects.
        The API is free, but it does have a rate limit of 100 requests per hour
        per IP address. If you exceed the rate limit, you will receive a 429 Too
        Many Requests error. To avoid this, you can use a proxy server, such as
        CloudFlare, to make multiple requests to the Randomuser.me API in
        parallel.
      </p>
      <h2>Part 3: Bonus</h2>
      <h3>Example JavaScript Code</h3>
      <p>
        Here is an example of how to fetch a random user using the Randomuser.me
        API and display their name, city, state, and country in the HTML.
      </p>
      <pre>
          <code>
            fetch('https://randomuser.me/api/?format=json')
             .then(response => response.json())
             .then(data => {
                const user = data.results[0];
                document.getElementById('user').textContent = user.name.first + ' ' + user.name.last;
              }).catch(error => {
                document.getElementById('user').textContent = 'Error fetching user data.';
              })
              ;
          </code>
        </pre>
      <h2>Display User</h2>
      <p>
        Click the button below to display a random user's name:
      </p>
      <button type="button" class="btn btn-primary m-3"
        onclick="loadUser()">Load User</button>
      <div class="container-sm" id="user"></div>
      <h2>Display Multiple Users</h2>
      <p>
        Click the button below to display 4 random users:
      </p>
      <button class="btn btn-primary m-3" type="button"
        onclick="loadUsers()">Load Users</button>
      <div class="container-sm" id="users"></div>
      <h3>Example jQuery Code</h3>
      <p>
        Here is an example of how to fetch and log the the user's name,
        password, geolocation, and birthday using the Randomuser.me API and
        jQuery.
      </p>
      <p>
        The code below uses the <code>.ajax()</code> method to make an AJAX
        request to the Randomuser.me API. The request URL is set to the API URL,
        and the <code>dataType</code> is set to <code>json</code>.
      </p>
      <pre>
          <code>
            function jQ() {
              $.ajax({
              url: 'https://randomuser.me/api/?format=json',
              dataType: 'json',
              success: function(data) {
              const user = data.results[0];

            // Display user's name, password, geolocation, and birthday

              $('#userjq').html(`
              <p>name: ${user.name.first} ${user.name.last}</p>
              <p>password: ${user.login.password}</p>
              <p>geolocation: ${user.location.coordinates.latitude}, ${user.location.coordinates.longitude}</p>
              <p>birthday: ${user.dob.date}</p>
            `);

            // Display user's profile picture
            const profilePic = user.picture.large;
            $('#userjq').append(`<img src="${profilePic}" alt="Profile Picture">`);
            },
            error: function(jqXHR, textStatus, errorThrown) {
              if (jqXHR.status === 0) {
                console.log('Not connected.\nPlease verify your network connection.');
              } else if (jqXHR.status == 404) {
                console.log('Requested page not found. [404]');
              } else if (jqXHR.status == 500) {
                console.log('Internal Server Error [500].');
                console.log('Server error [' + jqXHR.status + '].');
              } else if (textStatus === 'parsererror') {
                console.log('JSON parse error: ' + textStatus);
                console.log('Error:'+ jqXHR.responseText);
              } else if (textStatus === 'timeout') {
                console.log('Time out error.');
              } else if (textStatus === 'abort') {
                console.log('Ajax request aborted.');
              } else {
                console.log('Uncaught Error:'+ textStatus);
                console.log('Error:'+ jqXHR.responseText);
              }
            }
            });
            }
          </code>
        </pre>
      <p>
      <h3>Display User</h3>
      <p>
        Click the button below to display a random user's name:
      </p>
      <button type="button" class="btn btn-primary m-3" onclick="jQ()">Display
        User</button>
      <div id="userjq" class="container-sm ajax"></div>
      <h3>Display 100 Random Users</h3>
      <p>Click the following link to see a json response of 100 random users
        displaying only their gender, name, nationality, and email address:
        <a
          href="https://randomuser.me/api/?results=100&inc=gender,name,nat,email&noinfo&format=json">Generate
          100
          random users</a>
      </p>
      <hr>
    </main>
    <footer class="text-center">&copy; <span id="year"></span> David
      Arrizon
    </footer>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"></script>
    <script>
      function loadUser() {
        fetch('https://randomuser.me/api/?format=json')
          .then(response => response.json())
          .then(data => {
            const user = data.results[0];
            let userHtml =
              `<div class="card w-75">
                          <img
                            src="${user.picture.large}"
                            class="card-img-top"
                            alt="User Image">
                        <div class="card-body">
                          <h5 class="card-title">${user.name.first} ${user.name.last}</h5>
                          <p class="card-text">${user.email}</p>
                          <p class="card-text">${user.location.city}, ${user.location.state}</p>
                        </div>
                      </div>
                  `;
            document.getElementById('user').innerHTML = userHtml;
          })
          .catch(error => {
            document.getElementById('user').textContent = 'Error fetching user data.';
          });
      }
    </script>
    <script>
      function loadUsers() {
        fetch('https://randomuser.me/api/?results=4&format=json')
          .then(response => response.json())
          .then(data => {
            const users = data.results;
            let usersHtml = '<div class="card-group">';
            users.forEach(user => {
              usersHtml +=
                `
                  <div class="card">
                          <img src="${user.picture.large}" class="img-fluid" alt="User Image">
                        <div class="card-body">
                          <h5 class="card-title">${user.name.first} ${user.name.last}</h5>
                          <p class="card-text">${user.email}</p>
                          <p class="card-text">${user.location.city}, ${user.location.state}</p>
                        </div>
                      </div>
                  `;
            });
            document.getElementById('users').innerHTML = usersHtml;
          })
          .catch(error => {
            document.getElementById('users').textContent = 'Error fetching user data.';
          });
      }
    </script>
    <script>
      // Get current year
      const currentYear = new Date().getFullYear();
      // Get year from HTML footer
      document.getElementById('year').textContent = currentYear;

    </script>
    <script>
      function loadCDCatalog() {
        const xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            document.getElementById('status').innerHTML = 'CD Catalog loaded successfully.';
          } else if (this.readyState == 4) {
            document.getElementById('status').innerHTML = 'Error loading CD Catalog.';
          }
        }
        xhttp.onprogress = function (event) {
          if (event.lengthComputable) {
            const percentage = (event.loaded / event.total) * 100;
            document.getElementById('progressBar').style.width = percentage + '%';
          }
        }
        xhttp.open('GET', 'cd_catalog.xml', true);
        xhttp.send();

        xhttp.onload = function () {
          const xmlDoc = this.responseXML;
          const table = document.getElementById('cdCatalogTable');
          table.classList.remove('visually-hidden');
          const x = xmlDoc.getElementsByTagName("CD");
          for (let i = 0; i < x.length; i++) {
            const row = table.insertRow(-1);
            const titleCell = row.insertCell(0);
            const artistCell = row.insertCell(1);
            const yearCell = row.insertCell(2);
            titleCell.textContent = x[i].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue;
            artistCell.textContent = x[i].getElementsByTagName("ARTIST")[0].childNodes[0].nodeValue;
            yearCell.textContent = x[i].getElementsByTagName("YEAR")[0].childNodes[0].nodeValue;
            yearCell.classList.add('text-center');
          }
        }
      }

      function loadCDCatalogWithFetch() {
        const xhttp = new XMLHttpRequest();
        fetch('cd_catalog.xml')
          .then(response => response.text())
          .then(data => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data, 'text/xml');
            const table = document.getElementById('cdCatalogTable');
            table.classList.remove('visually-hidden');
            const x = xmlDoc.getElementsByTagName("CD");
            for (let i = 0; i < x.length; i++) {
              const row = table.insertRow(-1);
              const titleCell = row.insertCell(0);
              const artistCell = row.insertCell(1);
              const yearCell = row.insertCell(2);
              titleCell.textContent = x[i].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue;
              artistCell.textContent = x[i].getElementsByTagName("ARTIST")[0].childNodes[0].nodeValue;
              yearCell.textContent = x[i].getElementsByTagName("YEAR")[0].childNodes[0].nodeValue;
              yearCell.classList.add('text-center');
            }
          })
          .catch(error => {
            console.log('Error fetching CD catalog:', error);
          });
      }

      function loadCDCatalogWithFetchAndProgress() {
        const xhttp = new XMLHttpRequest();
        fetch('cd_catalog.xml')
          .then(response => response.text())
          .then(data => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data, 'text/xml');
            const table = document.getElementById('cdCatalogTable');
            table.classList.remove('visually-hidden');
            const x = xmlDoc.getElementsByTagName("CD");
            for (let i = 0; i < x.length; i++) {
              const row = table.insertRow(-1);
              const titleCell = row.insertCell(0);
              const artistCell = row.insertCell(1);
              const yearCell = row.insertCell(2);
              titleCell.textContent = x[i].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue;
              artistCell.textContent = x[i].getElementsByTagName("ARTIST")[0].childNodes[0].nodeValue;
              yearCell.textContent = x[i].getElementsByTagName("YEAR")[0].childNodes[0].nodeValue;
              yearCell.classList.add('text-center');
            }
          })
          .catch(error => {
            console.log('Error fetching CD catalog:', error);
          });
      }

      function loadCDs() {
        clearCDCatalogTable();
        loadCDCatalog();
      }

      function clearStatusMessage() {
        document.getElementById('status').innerHTML = '';
      }

      function clearCDCatalogTable() {
        const table = document.getElementById('cdCatalogTable');
        table.classList.add('visually-hidden');
        const tableRows = table.getElementsByTagName('tr');
        for (let i = tableRows.length - 1; i > 0; i--) {
          table.deleteRow(i);
        }
      }

      function loadCDsWithFetch() {
        clearCDCatalogTable();
        loadCDCatalogWithFetch();
      }
    </script>
    <script>
      function jQ() {
        $.ajax({
          url: 'https://randomuser.me/api/',
          dataType: 'json',
          success: function (data) {
            const user = data.results[0];
            $('#userjq').html(`<p>Name: ${user.name.first} ${user.name.last}</p>`);
            $('#userjq').html(`<p>Name: ${user.name.first} ${user.name.last}</p><img src="${user.picture.medium}" alt="User Image">`);
            $('#userjq').html(`
                <p>Name: ${user.name.first} ${user.name.last}</p>
                <p>Password: ${user.login.password}</p>
                <p>Geolocation: ${user.location.coordinates.latitude}, ${user.location.coordinates.longitude}</p>
                <p>Birthday: ${new Date(user.dob.date).toLocaleDateString()}</p>
                <img src="${user.picture.large}" alt="User Image" width="200" height="200">
              `);
          },
          error: function (xhr, status, error) {
            console.log('Error:', error);
            $('#userjq').html('Error fetching user data.');
          },
          complete: function (xhr, status) {
            console.log('Request complete:', status);
          },

          timeout: 5000 // 5 second timeout
        });
      }
    </script>
  </body>

</html>